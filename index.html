<!-- Results page -->
  <div id="results" class="q-box" style="display:none;">
    <div class="results-summary">
      <div class="q-header">Your Cyber Security Maturity Results</div>
      <div class="overall-score" id="overall-score">0%</div>
      <div class="maturity-level" id="maturity-level">Calculating...</div>
    </div>
    
    <h3 style="margin: 2rem 0 1rem;">Detailed Assessment Results</h3>
    <table class="pillars-table" id="pillars-table">
      <thead>
        <tr>
          <th>Security Pillar</th>
          <th>Your Score</th>
          <th>Maximum Score</th>
          <th>Maturity %</th>
          <th>Progress</th>
        </tr>
      </thead>
      <tbody id="pillars-body">
        <!-- Will be populated by JavaScript -->
      </tbody>
    </table>
    
    <div class="recommendations">
      <h2 style="text-align:center; margin-bottom:2rem;">Recommendations</h2>
      <div id="recommendations-container">
        <!-- Will be populated by JavaScript -->
      </div>
    </div>
    
    <div class="download-section">
      <div class="btn-box-wrap" style="justify-content: center;">
        <button class="button" onclick="location.reload()">Retake Assessment</button>
        <button class="pdf-button" id="pdfBtn" onclick="generatePDF()">Download PDF Report</button>
      </div>
    </div>
  </div>

  <script>
    // Scoring configuration (same as before)
    const scoringConfig = {
      q1: {
        maxScore: 50,
        pillar: 'Network Security',
        answers: {
          'Next-Generation Firewall (NGFW)': 5,
          'Intrusion Detection/Prevention Systems (IDS/IPS)': 5,
          'Network Segmentation and Microsegmentation': 5,
          'Network Access Control (NAC)': 5,
          'DNS and Content Filtering': 5,
          'User Entity Behavioural Analysis': 5,
          'Deception Technologies (e.g., honeypots)': 5,
          'SASE Secure Remote Access': 5,
          'VPN Secure Remote Access': 5,
          'Network Traffic Analysis (NTA)': 5
        }
      },
      // ... (all other scoring config remains the same)
    };

    // Pillar mapping for aggregation (same as before)
    const pillarMapping = {
      'Network Security': ['q1', 'q2', 'q3', 'q4', 'q5'],
      'Workspace Security': ['q6', 'q7', 'q8', 'q9', 'q10', 'q11', 'q12', 'q13', 'q14', 'q15', 'q16', 'q17'],
      'Cloud Security': ['q18'],
      'Application Security': ['q19'],
      'Email and Collaboration Security': ['q20'],
      'Data Security': ['q21'],
      'External Risk Management': ['q22'],
      'Identity and Access Management': ['q23'],
      'Security Monitoring & Threat Intelligence': ['q24'],
      'Incident Response & Recovery': ['q25'],
      'Security Operations': ['q26']
    };

    // Comprehensive recommendations for all pillars at different maturity levels
    const pillarRecommendations = {
      'Network Security': {
        low: [
          'Implement basic Next-Generation Firewall (NGFW) with intrusion prevention',
          'Deploy network segmentation to isolate critical assets',
          'Implement basic DNS and content filtering',
          'Establish network access control (NAC) for device authentication',
          'Consider basic VPN for secure remote access'
        ],
        medium: [
          'Enhance NGFW with advanced threat prevention capabilities',
          'Implement microsegmentation for granular control',
          'Deploy User Entity Behavior Analytics (UEBA)',
          'Consider SASE for modern remote access',
          'Implement network traffic analysis (NTA) for threat detection',
          'Add deception technologies for early threat detection'
        ],
        high: [
          'Implement full network automation and orchestration',
          'Deploy AI/ML powered threat detection across network',
          'Implement Zero Trust Network Access (ZTNA)',
          'Optimize network performance with SD-WAN integration',
          'Establish comprehensive network visibility and analytics'
        ]
      },
      'Workspace Security': {
        low: [
          'Implement basic endpoint protection (EDR/NGAV)',
          'Establish device management policies',
          'Deploy mobile device management (MDM)',
          'Implement basic remote access security',
          'Establish vulnerability management process'
        ],
        medium: [
          'Enhance endpoint protection with advanced EDR/XDR',
          'Implement comprehensive vulnerability management',
          'Deploy secure web gateway for remote users',
          'Implement data loss prevention (DLP) for endpoints',
          'Establish application control policies',
          'Implement USB and peripheral device control'
        ],
        high: [
          'Implement XDR for cross-layer threat detection',
          'Deploy advanced threat hunting capabilities',
          'Implement automated incident response',
          'Establish unified endpoint security platform',
          'Implement behavioral biometrics for user verification'
        ]
      },
      'Cloud Security': {
        low: [
          'Implement basic cloud security posture management',
          'Enable encryption for data at rest and in transit',
          'Implement cloud firewall rules',
          'Establish cloud access security policies',
          'Implement basic identity and access management'
        ],
        medium: [
          'Deploy Cloud Workload Protection Platform (CWPP)',
          'Implement container security scanning',
          'Enable cloud-native application protection',
          'Implement cloud infrastructure entitlement management',
          'Deploy Cloud Access Security Broker (CASB)',
          'Implement network segmentation in cloud environments'
        ],
        high: [
          'Implement full Cloud-Native Application Protection Platform (CNAPP)',
          'Deploy advanced CIEM for identity governance',
          'Implement automated cloud security orchestration',
          'Establish comprehensive cloud security monitoring',
          'Implement AI-powered cloud threat detection'
        ]
      },
      'Application Security': {
        low: [
          'Implement Web Application Firewall (WAF)',
          'Establish basic application security testing',
          'Implement OWASP Top 10 mitigation',
          'Enable basic API security controls',
          'Establish secure coding guidelines'
        ],
        medium: [
          'Implement comprehensive SAST/DAST testing',
          'Integrate security into CI/CD pipelines',
          'Implement advanced API security controls',
          'Deploy software composition analysis (SCA)',
          'Implement runtime application self-protection (RASP)',
          'Establish DevSecOps practices'
        ],
        high: [
          'Implement advanced application security monitoring',
          'Deploy AI-powered application security',
          'Implement comprehensive software supply chain security',
          'Establish application security orchestration',
          'Implement automated security testing throughout SDLC'
        ]
      },
      'Email and Collaboration Security': {
        low: [
          'Implement basic email security with spam filtering',
          'Enable basic phishing protection',
          'Establish email encryption policies',
          'Implement basic collaboration tool security',
          'Establish user awareness training'
        ],
        medium: [
          'Deploy advanced phishing simulation and training',
          'Implement email sandboxing for attachments',
          'Enable URL rewriting and click protection',
          'Implement DLP for email and collaboration',
          'Deploy impersonation detection',
          'Implement collaboration tool monitoring'
        ],
        high: [
          'Implement AI-powered email threat detection',
          'Deploy advanced impersonation detection',
          'Implement real-time collaboration monitoring',
          'Establish unified email and collaboration security',
          'Implement comprehensive email encryption and archiving'
        ]
      },
      'Data Security': {
        low: [
          'Implement basic data classification framework',
          'Enable disk encryption on endpoints',
          'Establish basic data loss prevention',
          'Implement basic access controls',
          'Establish data retention policies'
        ],
        medium: [
          'Implement comprehensive data classification and labeling',
          'Deploy advanced data loss prevention (DLP)',
          'Implement tokenization and masking',
          'Establish data access governance',
          'Implement data discovery and mapping',
          'Enable data residency controls'
        ],
        high: [
          'Implement AI-powered data security analytics',
          'Deploy advanced data privacy controls',
          'Implement comprehensive data governance',
          'Establish automated data protection',
          'Implement real-time data activity monitoring'
        ]
      },
      'External Risk Management': {
        low: [
          'Establish basic vendor risk assessment process',
          'Implement vulnerability management',
          'Establish basic risk management framework',
          'Implement basic third-party access controls',
          'Establish onboarding/offboarding procedures'
        ],
        medium: [
          'Implement continuous attack surface monitoring',
          'Deploy dark web scanning for sensitive information',
          'Establish comprehensive vendor risk management',
          'Implement threat intelligence integration',
          'Deploy digital brand protection',
          'Implement continuous vendor monitoring'
        ],
        high: [
          'Implement AI-powered external risk analytics',
          'Deploy advanced threat intelligence platform',
          'Establish comprehensive risk quantification',
          'Implement automated risk remediation',
          'Establish real-time external threat monitoring'
        ]
      },
      'Identity and Access Management': {
        low: [
          'Implement Multi-Factor Authentication (MFA)',
          'Establish basic access control policies',
          'Implement password policy enforcement',
          'Establish basic user lifecycle management',
          'Implement basic privileged access controls'
        ],
        medium: [
          'Implement Single Sign-On (SSO)',
          'Deploy Privileged Access Management (PAM)',
          'Establish Role-Based Access Control (RBAC)',
          'Implement Just-In-Time (JIT) access',
          'Deploy access reviews and recertification',
          'Implement identity federation'
        ],
        high: [
          'Implement AI-powered identity analytics',
          'Deploy behavioral biometrics',
          'Establish comprehensive identity governance',
          'Implement zero trust identity framework',
          'Establish automated identity lifecycle management'
        ]
      },
      'Security Monitoring & Threat Intelligence': {
        low: [
          'Implement basic Security Information and Event Management (SIEM)',
          'Establish log aggregation',
          'Implement basic alerting',
          'Establish threat intelligence feeds',
          'Implement basic anomaly detection'
        ],
        medium: [
          'Implement Security Orchestration, Automation and Response (SOAR)',
          'Deploy User and Entity Behavior Analytics (UEBA)',
          'Establish comprehensive threat intelligence',
          'Implement threat hunting capabilities',
          'Deploy deception technologies',
          'Implement MITRE ATT&CK mapping'
        ],
        high: [
          'Implement AI-powered security analytics',
          'Deploy advanced threat hunting platform',
          'Establish predictive threat intelligence',
          'Implement automated threat response',
          'Establish comprehensive security observability'
        ]
      },
      'Incident Response & Recovery': {
        low: [
          'Establish Incident Response Plan (IRP)',
          'Implement basic forensics capabilities',
          'Establish crisis communication plan',
          'Implement basic backup procedures',
          'Establish disaster recovery plan'
        ],
        medium: [
          'Implement tabletop exercises and simulations',
          'Deploy automated virtual patching',
          'Establish business continuity plan',
          'Implement playbooks for common scenarios',
          'Deploy ransomware response protocols',
          'Establish post-incident review process'
        ],
        high: [
          'Implement AI-powered incident response',
          'Deploy automated incident orchestration',
          'Establish comprehensive incident simulation',
          'Implement predictive incident response',
          'Establish continuous incident readiness'
        ]
      },
      'Security Operations': {
        low: [
          'Establish Security Operations Center (SOC)',
          'Implement basic risk assessments',
          'Establish vulnerability assessments',
          'Implement penetration testing',
          'Establish business impact analyses'
        ],
        medium: [
          'Implement continuous threat and exposure management',
          'Deploy unified security management',
          'Establish AI-assisted security tools',
          'Implement shared indicators of compromise',
          'Deploy open security platform',
          'Establish comprehensive security metrics'
        ],
        high: [
          'Implement AI-powered security operations',
          'Deploy predictive security analytics',
          'Establish comprehensive security automation',
          'Implement continuous security optimization',
          'Establish security operations excellence framework'
        ]
      }
    };

    // General recommendations that apply to all organizations
    const generalRecommendations = [
      'Consider consolidating security vendors to reduce complexity and improve visibility',
      'Implement a unified security management platform for centralized control',
      'Conduct regular security awareness training for all employees',
      'Establish a continuous improvement process for security controls',
      'Regularly review and update security policies and procedures',
      'Consider engaging with Check Point for a comprehensive security assessment',
      'Implement regular security audits and compliance checks',
      'Establish metrics and KPIs to measure security effectiveness',
      'Consider managed security services for 24/7 monitoring and response',
      'Implement regular backup and recovery testing procedures'
    ];

    let currentQuestion = 0;
    const totalQuestions = 26;
    let answers = {};

    // ... (all other functions remain the same until showResultsPage)

    function showResultsPage() {
      document.getElementById('final').style.display = 'none';
      document.getElementById('results').style.display = 'block';
      updateUI();

      // Calculate scores for each pillar
      const pillarScores = calculatePillarScores();
      
      // Calculate overall score
      const overallScore = calculateOverallScore(pillarScores);
      
      // Display overall score
      document.getElementById('overall-score').textContent = `${overallScore}%`;
      document.getElementById('maturity-level').textContent = getMaturityLevel(overallScore);
      
      // Display pillar scores in table
      displayPillarScores(pillarScores);
      
      // Generate recommendations based on scores
      generateIntelligentRecommendations(pillarScores, overallScore);
    }

    function calculatePillarScores() {
      const pillarScores = {};
      
      // Initialize all pillars
      Object.keys(pillarMapping).forEach(pillar => {
        pillarScores[pillar] = {
          score: 0,
          maxScore: 0,
          percentage: 0
        };
      });
      
      // Calculate scores for each question
      for (let i = 1; i <= totalQuestions; i++) {
        const questionKey = `q${i}`;
        const selectedAnswers = answers[questionKey] || [];
        const config = scoringConfig[questionKey];
        
        if (!config) continue;
        
        const pillar = config.pillar;
        
        // Calculate score for this question
        let questionScore = 0;
        selectedAnswers.forEach(answerText => {
          if (config.answers[answerText] !== undefined) {
            questionScore += config.answers[answerText];
          }
        });
        
        // For radio questions, ensure we don't exceed max
        if (document.querySelector(`input[name="${questionKey}"][type="radio"]`)) {
          questionScore = Math.min(questionScore, config.maxScore);
        }
        
        // Update pillar scores
        pillarScores[pillar].score += questionScore;
        pillarScores[pillar].maxScore += config.maxScore;
      }
      
      // Calculate percentages
      Object.keys(pillarScores).forEach(pillar => {
        const pillarData = pillarScores[pillar];
        pillarData.percentage = pillarData.maxScore > 0 
          ? Math.round((pillarData.score / pillarData.maxScore) * 100) 
          : 0;
      });
      
      return pillarScores;
    }

    function calculateOverallScore(pillarScores) {
      let totalScore = 0;
      let totalMaxScore = 0;
      
      Object.keys(pillarScores).forEach(pillar => {
        totalScore += pillarScores[pillar].score;
        totalMaxScore += pillarScores[pillar].maxScore;
      });
      
      return totalMaxScore > 0 ? Math.round((totalScore / totalMaxScore) * 100) : 0;
    }

    function getMaturityLevel(percentage) {
      if (percentage >= 85) return 'Advanced Maturity';
      if (percentage >= 70) return 'Established Maturity';
      if (percentage >= 50) return 'Developing Maturity';
      if (percentage >= 30) return 'Initial Maturity';
      return 'Limited Maturity';
    }

    function displayPillarScores(pillarScores) {
      const tableBody = document.getElementById('pillars-body');
      tableBody.innerHTML = '';
      
      Object.keys(pillarScores).forEach(pillar => {
        const data = pillarScores[pillar];
        const row = document.createElement('tr');
        
        row.innerHTML = `
          <td class="pillar-name">${pillar}</td>
          <td class="score-cell">${data.score}</td>
          <td class="score-cell">${data.maxScore}</td>
          <td class="score-cell"><strong>${data.percentage}%</strong></td>
          <td>
            <div class="score-bar-container">
              <div class="score-bar" style="width: ${data.percentage}%; background: ${getScoreColor(data.percentage)};"></div>
            </div>
          </td>
        `;
        
        tableBody.appendChild(row);
      });
    }

    function getScoreColor(percentage) {
      if (percentage >= 80) return '#2E7D32'; // Green
      if (percentage >= 60) return '#FF9800'; // Orange
      return '#D32F2F'; // Red
    }

    function generateIntelligentRecommendations(pillarScores, overallScore) {
      const container = document.getElementById('recommendations-container');
      container.innerHTML = '';
      
      // If overall score is 100%, show congratulations message
      if (overallScore === 100) {
        container.innerHTML = `
          <div class="no-recommendations">
            <h3>ðŸŽ‰ Excellent Security Posture!</h3>
            <p>Your organization has achieved perfect scores across all security pillars. Congratulations on maintaining an exceptional security maturity level!</p>
            <p>Continue your security excellence by:</p>
            <ul>
              <li>Regularly reviewing and updating security controls</li>
              <li>Staying current with emerging threats and technologies</li>
              <li>Conducting regular security awareness training</li>
              <li>Participating in industry security communities</li>
              <li>Considering Check Point's advanced security solutions for continuous improvement</li>
            </ul>
          </div>
        `;
        return;
      }
      
      // Determine which pillars need recommendations (below 80%)
      const pillarsNeedingImprovement = Object.keys(pillarScores)
        .filter(pillar => pillarScores[pillar].percentage < 80)
        .map(pillar => ({
          name: pillar,
          percentage: pillarScores[pillar].percentage,
          level: getPillarLevel(pillarScores[pillar].percentage)
        }))
        .sort((a, b) => a.percentage - b.percentage);
      
      // If no pillars need improvement (all above 80%), show advanced recommendations
      if (pillarsNeedingImprovement.length === 0) {
        container.innerHTML = `
          <div class="recommendations-grid">
            <div class="recommendation-card">
              <h4>Advanced Security Optimization</h4>
              <p>Your organization has strong security foundations. Consider these advanced improvements:</p>
              <ul>
                <li>Implement AI-powered security analytics for predictive threat detection</li>
                <li>Deploy advanced threat hunting capabilities</li>
                <li>Establish comprehensive security automation and orchestration</li>
                <li>Implement zero trust architecture across all environments</li>
                <li>Consider Check Point's Infinity Platform for unified security management</li>
              </ul>
            </div>
            <div class="recommendation-card">
              <h4>Continuous Improvement</h4>
              <ul>
                <li>Establish security metrics and KPIs for continuous measurement</li>
                <li>Implement regular red team exercises</li>
                <li>Participate in threat intelligence sharing communities</li>
                <li>Consider third-party security assessments for external validation</li>
                <li>Stay current with emerging security technologies and threats</li>
              </ul>
            </div>
          </div>
        `;
        return;
      }
      
      // Create recommendations grid
      const grid = document.createElement('div');
      grid.className = 'recommendations-grid';
      
      // Add recommendations for each pillar needing improvement
      pillarsNeedingImprovement.forEach(pillar => {
        if (pillarRecommendations[pillar.name] && pillarRecommendations[pillar.name][pillar.level]) {
          const card = document.createElement('div');
          card.className = 'recommendation-card';
          
          // Determine how many recommendations to show based on score
          const recCount = getRecommendationCount(pillar.percentage);
          const recommendations = pillarRecommendations[pillar.name][pillar.level].slice(0, recCount);
          
          card.innerHTML = `
            <h4>${pillar.name} (${pillar.percentage}%)</h4>
            <ul>
              ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
            </ul>
          `;
          
          grid.appendChild(card);
        }
      });
      
      // Add general recommendations card
      const generalCard = document.createElement('div');
      generalCard.className = 'recommendation-card';
      
      // Determine how many general recommendations to show based on overall score
      const generalRecCount = getGeneralRecommendationCount(overallScore);
      const selectedGeneralRecs = generalRecommendations.slice(0, generalRecCount);
      
      generalCard.innerHTML = `
        <h4>General Security Recommendations</h4>
        <ul>
          ${selectedGeneralRecs.map(rec => `<li>${rec}</li>`).join('')}
        </ul>
      `;
      
      grid.appendChild(generalCard);
      
      container.appendChild(grid);
    }

    function getPillarLevel(percentage) {
      if (percentage < 40) return 'low';
      if (percentage < 70) return 'medium';
      return 'high';
    }

    function getRecommendationCount(percentage) {
      // Lower scores get more recommendations
      if (percentage < 30) return 5; // Very low score: 5 recommendations
      if (percentage < 50) return 4; // Low score: 4 recommendations
      if (percentage < 70) return 3; // Medium score: 3 recommendations
      return 2; // High but below 80%: 2 recommendations
    }

    function getGeneralRecommendationCount(overallScore) {
      // Lower overall scores get more general recommendations
      if (overallScore < 30) return 8;
      if (overallScore < 50) return 6;
      if (overallScore < 70) return 4;
      return 3;
    }

    function generatePDF() {
      alert('PDF generation would be implemented here. This would typically use jsPDF or similar library to generate a comprehensive report with all assessment results.');
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.answer input').forEach(inp => {
        inp.addEventListener('change', () => {
          const answer = inp.closest('.answer');
          answer.classList.toggle('selected', inp.checked);
          if (inp.type === 'radio') {
            document.querySelectorAll(`input[name="${inp.name}"]`).forEach(r => {
              if (r !== inp) r.closest('.answer').classList.remove('selected');
            });
          }
        });
      });

      // Exclusive "Not sure" / "None" logic
      document.querySelectorAll('.uncheck-all input').forEach(ex => {
        ex.addEventListener('change', function() {
          if (this.checked) {
            const q = this.name;
            document.querySelectorAll(`input[name="${q}"]:not(.uncheck-all input)`).forEach(inp => {
              inp.checked = false;
              inp.closest('.answer').classList.remove('selected');
            });
          }
        });
      });

      updateUI();
    });
  </script>
</body>
</html>
